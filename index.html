<!DOCTYPE html>
<html lang="en">
<head>
    <title>Draw a Circle</title>
    <meta property="og:description" content="Draw a radius to approximate a location with Turf.js" />
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.4.0/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@5.4.0/dist/maplibre-gl.js'></script>
    <script src='generatorMap.js'></script>
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
    </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@7/turf.min.js"></script>
<div id="map"></div>
<script>
    
    
    const radiusCenter = [-4.235, 55.900];
    const map = new maplibregl.Map({
        container: 'map',
        zoom: 5.5,
        center: radiusCenter,
        style: {
            version: 8,
            sources: {
                        osm: {
                            type: 'raster',
                            tiles: ['https://tile.openstreetmap.org/{z}/{x}/{y}.png'],
                            tileSize: 256,
                            attribution: '&copy; OpenStreetMap Contributors',
                            maxzoom: 19
                        }
                    },
            layers: [
                        {
                            id: 'osm',
                            type: 'raster',
                            source: 'osm'
                        }
                    ]
        },
        maxZoom: 18,
        maxPitch: 85
    });

    map.on('load', async () => {
        // Generate a polygon using turf.circle
        // See https://turfjs.org/docs/#circle

        let allBMUs = await getBMUs(); // get the BMU data from the generatorMap.js file

        const radius = 500; // kilometer
        const options = {
            steps: 64,
            units: 'meters',
        };
        
        
        

        for(i in allBMUs){
            
            let radius;

            if(parseFloat(allBMUs[i].installedCapacity) < 10){
                radius = 1000;
            } else {
                radius = parseInt(allBMUs[i].installedCapacity*10);
            }
            
            console.log(allBMUs[i].siteName, allBMUs[i].lon, allBMUs[i].lat, allBMUs[i].installedCapacity, radius);
            
            let circle = turf.circle([parseFloat(allBMUs[i].lon), parseFloat(allBMUs[i].lat)], radius, options);
        

            // Add the circle as a GeoJSON source
            map.addSource(`installedCapacity-radius${i}`, {
                type: 'geojson',
                data: circle
            });

            // Add a fill layer with some transparency
            map.addLayer({
                id: `installedCapacity-radius${i}`,
                type: 'fill',
                source: `installedCapacity-radius${i}`,
                paint: {
                    'fill-color': '#8CCFFF',
                    'fill-opacity': 0.0
                }
            });

            // Add a line layer to draw the circle outline
            map.addLayer({
                id: `installedCapacity-radius-outline${i}`,
                type: 'line',
                source: `installedCapacity-radius${i}`,
                paint: {
                    'line-color': '#0094ff',
                    'line-width': 1
                }
            });
        }
    
    });
</script>
</body>
</html>